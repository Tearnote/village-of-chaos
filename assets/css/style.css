/* #region CSS reset */
/* Adapted from https://www.joshwcomeau.com/css/custom-css-reset/ */

*,
*::before,
*::after {
	box-sizing: border-box;
	margin: 0;
	overflow-wrap: break-word;
}

html,
body {
	height: 100%;
}

body {
	line-height: 1.5;
}

img,
picture,
video,
canvas,
svg {
	display: block;
	max-width: 100%;
}

input,
button,
textarea,
select {
	font: inherit;
}

a:visited {
	color: inherit;
}

/* #endregion */

/* #region Pure CSS tabs */
/* Inspired by https://codepen.io/alvarotrigo/pen/RwLzvQz */

.tabs {
	display: flex;
	flex-flow: row wrap;
	align-content: flex-end;
}

.tabs > input[type="radio"] {
	display: none;
}

.tabs > label {
	order: 20;
	height: fit-content;
	cursor: pointer;
	user-select: none;
}

.tabs > .tab {
	order: 10;
	width: 100%;
	height: auto;
	display: none;
}

.tabs > input[type="radio"]:checked + label + .tab {
	display: block;
}

/* #endregion */

/* #region Site style and general layout */

body {
	display: flex;
	/* Placeholder */
	font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
		sans-serif;
	background-color: antiquewhite;

	/* Element visibility variables, controlled by JS */
	--income-display: none;
	--stone-display: none;
	--craft-speed-display: none;
	--research-speed-display: none;
	--assign-display: none;
	--research-display: none;
	--chaos-display: none;
	--mentor-display: none;
	--manager-display: none;
	--fisherman-display: none;
	--miner-display: none;
	--blacksmith-display: none;
	--professor-display: none;

	/* Controls sizing of the two main page sections */
	--main-size: min(100vw, 100vh);
}

@media (orientation: landscape) {
	body {
		flex-flow: row;
	}
}

@media (orientation: portrait) {
	body {
		flex-flow: column;
	}
}

#main {
	width: var(--main-size);
	height: var(--main-size);
	display: flex;
	flex-flow: column;
	justify-content: space-between;
}

#side {
	display: flex;
	justify-content: space-between;
	background-color: brown;
}

@media (orientation: landscape) {
	#side {
		flex-direction: column;
		min-width: 24rem;
		width: calc(100vw - var(--main-size));
		height: 100%;
	}
}

@media (orientation: portrait) {
	#side {
		flex-direction: row;
		width: 100%;
		min-height: 24rem;
		height: calc(100vh - var(--main-size));
	}
}

button {
	cursor: pointer;
}

/* #endregion */

/* #region Game world */

#world {
	/*
	We need to calculate scale from JS,
	because calc() doesn't support floats
	*/
	--scale: 1;
	position: absolute;
	width: 640px;
	height: 640px;
	/*
	Because scale() zooms in from the center of the element,
	we need to push the element away from the edge to make sure
	that it stays in the same place after the scaling
	*/
	left: calc(320px * (var(--scale) - 1));
	top: calc(320px * (var(--scale) - 1));
	z-index: -1;
	image-rendering: pixelated;
	transform: scale(var(--scale));
}

#world > img {
	position: absolute;
	object-fit: contain;
}

#terrain-img {
	left: 0;
	top: 0;
}

#tent-img {
	display: var(--assign-display);
	left: 320px;
	top: 361px;
}

#pier-img {
	display: var(--fisherman-display);
	left: 112px;
	top: 304px;
}

#quarry-img {
	display: var(--miner-display);
	left: 337px;
	top: 130px;
}

#smithy-img {
	display: var(--blacksmith-display);
	left: 261px;
	top: 288px;
}

#academy-img {
	display: var(--professor-display);
	left: 138px;
	top: 377px;
}

/* #endregion */

/* #region Header */

header {
	flex: 0 0 auto;
	width: 100%;
	height: 4rem;
	display: flex;
	flex-flow: row;
	justify-content: space-between;
	align-items: center;
	background-color: cornflowerblue;
}

#resources {
	display: flex;
	flex-flow: row;
}

#resources > div {
	min-width: 5rem;
	text-align: center;
	margin-left: 0.5rem;
}

.income {
	display: var(--income-display);
}

.stone {
	display: var(--stone-display);
}

.craft-speed {
	display: var(--craft-speed-display);
}

.research-speed {
	display: var(--research-speed-display);
}

#system {
	margin-right: 1rem;
	display: flex;
	flex-flow: row;
}

#system > button {
	margin: 0 0.3rem;
}

#reset {
	color: red;
}

/* #endregion */

/* #region Tabbed interface */

#interface {
	flex: 1 0 auto;
}

#interface > .tab {
	overflow-y: auto;
	background-color: chartreuse;
}

#interface > label {
	padding: 0.5rem 1rem;
	background-color: lavender;
}

#assign + label {
	display: var(--assign-display);
}

#research + label {
	display: var(--research-display);
}

#interface > input[type="radio"]:checked + label {
	background-color: gray;
}

#assign-tab > table {
	text-align: left;
}

#assign-tab > table > thead {
	text-align: center;
}

#assign-tab > table > thead > tr > th,
#assign-tab > table > tbody > tr > td {
	padding: 0.2rem 0.5rem;
}

#assign-tab > table > tbody > tr > :first-child {
	text-align: right;
}

#assign-tab > table > tbody > tr > :last-child {
	text-align: center;
}

#assign-tab > table > thead > tr > :nth-child(3),
#assign-tab > table > tbody > tr > :nth-child(3) {
	display: var(--mentor-display);
}

#assign-tab > table > thead > tr > :nth-child(4),
#assign-tab > table > tbody > tr > :nth-child(4) {
	display: var(--manager-display);
}

#assign-tab > table > thead > tr > :last-child,
#assign-tab > table > tbody > tr > :last-child {
	display: var(--chaos-display);
}

.fisherman {
	display: var(--fisherman-display);
}

.miner {
	display: var(--miner-display);
}

.blacksmith {
	display: var(--blacksmith-display);
}

.professor {
	display: var(--professor-display);
}

/* #endregion */

/* #region Gathering */

#gathering {
	width: fit-content;
	align-self: center;
	display: flex;
	justify-content: center;
	flex-flow: column;
	margin: 2rem;
}

#gathering > button {
	margin: 0.4rem;
	padding: 0.2rem 0.5rem;
}

/* #endregion */

/* #region Log */

#log {
	min-width: 20rem;
	width: 40%;
	min-height: 10rem;
	height: 20%;
	display: flex;
	flex-flow: column-reverse; /* Keeps container scrolled down */
	overflow-y: scroll;
	margin: 0.5rem;
	padding: 0.5rem;
	font-family: "Courier New", Courier, monospace;
	font-size: 0.8rem;
	background-color: rgba(255, 255, 255, 0.6);
	backdrop-filter: blur(1rem);
}

#log > p:not(:last-child) {
	padding-top: 0.2rem;
	border-top: 1px solid rgba(0, 0, 0, 0.12);
	margin-top: 0.2rem;
}

.info {
	color: blue;
}

.story {
	color: darkgreen;
}

.event {
	color: orangered;
}

/* #endregion */

/* #region Upgrades */

.upgrade {
	position: relative;
	margin: 0.5rem;
	border: 1px solid black;
	padding: 0.5rem 1rem;
	background-color: white;
	cursor: pointer;
	user-select: none;
	--progress: 0%;
}

.upgrade.inactive {
	background-color: darkgray;
}

.upgrade::after {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: 0;
	width: var(--progress);
	height: 100%;
}

#craft-tab > .upgrade::after {
	background-color: rgba(152, 255, 160, 0.4);
}

#research-tab > .upgrade::after {
	background-color: rgba(152, 154, 255, 0.4);
}

/* #endregion */

/* #region Tutorial pop-up */

#popup-shroud {
	display: none; /* Controlled by JS */
	position: fixed;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.6);
	user-select: none; /* Prevent accidental select by spamming the shroud */
}

#popup {
	position: fixed;
	top: 0; /* Controlled by JS */
	left: 0; /* Controlled by JS */
	display: flex;
	flex-flow: column;
	align-items: center;
	text-align: justify;
	margin: 0.2rem;
	border: paleturquoise solid 4px;
	padding: 0.8rem 1rem;
	background-color: white;
	user-select: text; /* Re-enable inherited select on the pop-up directly */
}

#popup-text {
	max-width: 24rem;
	margin-bottom: 0.5rem;
}

#popup-dismiss {
	width: fit-content;
}

/* #endregion */
